{"version":3,"sources":["../../src/api/middlewares.js"],"names":["loginRequired","req","res","next","header","status","send","message","try_token","split","token","verifyToken","err","payload","UserModel","findById","sub","exec","user","error","password"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;kBAEe;AACbA,iBAAe,uBAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjC,QAAI,CAACF,IAAIG,MAAJ,CAAW,eAAX,CAAL,EAAkC,OAAOF,IAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAS,4DAAV,EAArB,CAAP;;AAElC;AACA,QAAIC,YAAYP,IAAIG,MAAJ,CAAW,eAAX,EAA4BK,KAA5B,CAAkC,GAAlC,EAAuC,CAAvC,CAAhB;AACAC,oBAAMC,WAAN,CAAkBH,SAAlB,EAA6B,UAACI,GAAD,EAAMC,OAAN,EAAkB;AAC7C,UAAID,GAAJ,EAAS,OAAOV,IAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBM,GAArB,CAAP;AACTE,sBAAUC,QAAV,CAAmBF,QAAQG,GAA3B,EACGC,IADH,CACQ,UAACL,GAAD,EAAMM,IAAN,EAAe;AACnB,YAAIN,OAAO,CAACM,IAAZ,EAAkB;AACd,iBAAOhB,IAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBM,OAAO;AAC/BO,mBAAO;AADwB,WAA5B,CAAP;AAGH;AACD,eAAOD,KAAKE,QAAZ;AACAnB,YAAIiB,IAAJ,GAAWA,IAAX;AACAf;AACD,OAVH;AAWD,KAbD;AAcD;AApBY,C","file":"middlewares.js","sourcesContent":["import UserModel from '../user/model';\r\nimport token from '../util/token';\r\n\r\nexport default {\r\n  loginRequired: (req, res, next) => {\r\n    if (!req.header('Authorization')) return res.status(401).send({message: 'Please make sure your request has an Authorization header.'});\r\n    \r\n    // Validate jwt\r\n    let try_token = req.header('Authorization').split(' ')[0];\r\n    token.verifyToken(try_token, (err, payload) => {\r\n      if (err) return res.status(401).send(err);\r\n      UserModel.findById(payload.sub)\r\n        .exec((err, user) => {\r\n          if (err || !user) {\r\n              return res.status(404).send(err || {\r\n                  error: 'middleware User not found!!!'\r\n              });\r\n          }\r\n          delete user.password;\r\n          req.user = user;\r\n          next();\r\n        })\r\n    })\r\n  }\r\n}"]}