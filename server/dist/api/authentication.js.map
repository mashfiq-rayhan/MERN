{"version":3,"sources":["../../src/api/authentication.js"],"names":["signup","req","res","next","body","email","password","firstName","lastName","status","send","error","UserModel","findOne","err","existingUser","user","name","first","last","save","savedUser","json","success","token","generateToken","signin","comparedPassword","good"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;kBAEe;AACXA,YAAS,gBAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAAA,wBACwBF,IAAIG,IAD5B;AAAA,YACjBC,KADiB,aACjBA,KADiB;AAAA,YACVC,QADU,aACVA,QADU;AAAA,YACAC,SADA,aACAA,SADA;AAAA,YACWC,QADX,aACWA,QADX;;;AAGzB,YAAI,CAACH,KAAD,IAAU,CAACC,QAAf,EAAyB;AACrB,mBAAOJ,IACFO,MADE,CACK,GADL,EAEFC,IAFE,CAEG,EAACC,OAAO,sCAAR,EAFH,CAAP;AAGH;AACDC,wBACKC,OADL,CACa;AACLR,mBAAOA;AADF,SADb,EAGO,UAAUS,GAAV,EAAeC,YAAf,EAA6B;AAC5B,gBAAID,GAAJ,EAAS,OAAOZ,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBI,GAArB,CAAP;AACT,gBAAIC,YAAJ,EAAkB;AACd,uBAAOb,IACFO,MADE,CACK,GADL,EAEFC,IAFE,CAEG,EAACC,OAAO,iBAAR,EAFH,CAAP;AAGH;AACD,gBAAMK,OAAO,IAAIJ,eAAJ,CAAc;AACvBK,sBAAM;AACFC,2BAAOX,SADL;AAEFY,0BAAMX;AAFJ,iBADiB;AAKvBH,uBAAOA,KALgB;AAMvBC,0BAAUA;AANa,aAAd,CAAb;;AASAU,iBAAKI,IAAL,CAAU,UAAUN,GAAV,EAAeO,SAAf,EAA0B;AAChC,oBAAIP,GAAJ,EAAS;AACL,2BAAOX,KAAKW,GAAL,CAAP;AACH;;AAEDZ,oBAAIoB,IAAJ,CAAS;AACLC,6BAAS,IADJ;AAELC,2BAAOA,gBAAMC,aAAN,CAAoBJ,SAApB;AAFF,iBAAT;AAIH,aATD;AAUH,SA7BL;AA8BH,KAvCU;;AAyCXK,YAAQ,gBAACzB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACxB,YAAME,QAAQJ,IAAIG,IAAJ,CAASC,KAAvB;AACA,YAAMC,WAAWL,IAAIG,IAAJ,CAASE,QAA1B;AACA,YAAI,CAACD,KAAD,IAAU,CAACC,QAAf,EAAyB;AACrB,mBAAOJ,IACFO,MADE,CACK,GADL,EAEFC,IAFE,CAEG,EAACC,OAAO,sCAAR,EAFH,CAAP;AAGH;AACDC,wBACKC,OADL,CACa;AACLR,mBAAOA;AADF,SADb,EAGO,UAAUS,GAAV,EAAeC,YAAf,EAA6B;AAC5B,gBAAID,OAAO,CAACC,YAAZ,EAA0B;AACtB,uBAAOb,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBI,OAAO,EAACH,OAAO,gBAAR,EAA5B,CAAP;AACH;AACD,gBAAII,YAAJ,EAAkB;AACdA,6BAAaY,gBAAb,CAA8BrB,QAA9B,EAAwC,UAASQ,GAAT,EAAcc,IAAd,EAAoB;AACxD,wBAAId,OAAO,CAACc,IAAZ,EAAkB;AACV,+BAAO1B,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBI,OAAO,gBAA5B,CAAP;AACH;;AAEDZ,wBAAIQ,IAAJ,CAAS;AACLc,+BAAOA,gBAAMC,aAAN,CAAoBV,YAApB;AADF,qBAAT;AAGP,iBARD;AASH;AACJ,SAlBL;AAmBH;AApEU,C","file":"authentication.js","sourcesContent":["import token from '../util/token';\r\nimport UserModel from '../user/model';\r\n\r\nexport default {\r\n    signup : (req, res, next) => {\r\n        const { email, password, firstName, lastName } = req.body;\r\n    \r\n        if (!email || !password) {\r\n            return res\r\n                .status(422)\r\n                .send({error: 'You must provide email and password.'});\r\n        }\r\n        UserModel\r\n            .findOne({\r\n                email: email\r\n            }, function (err, existingUser) {\r\n                if (err) return res.status(422).send(err);\r\n                if (existingUser) {\r\n                    return res\r\n                        .status(422)\r\n                        .send({error: 'Email is in use'});\r\n                }\r\n                const user = new UserModel({\r\n                    name: {\r\n                        first: firstName, \r\n                        last: lastName\r\n                    },\r\n                    email: email,\r\n                    password: password\r\n                })\r\n    \r\n                user.save(function (err, savedUser) {\r\n                    if (err) {\r\n                        return next(err)\r\n                    }\r\n    \r\n                    res.json({\r\n                        success: true,\r\n                        token: token.generateToken(savedUser)\r\n                    })\r\n                })\r\n            })\r\n    },\r\n    \r\n    signin: (req, res, next) => {\r\n        const email = req.body.email;\r\n        const password = req.body.password;\r\n        if (!email || !password) {\r\n            return res\r\n                .status(422)\r\n                .send({error: 'You must provide email and password.'});\r\n        }\r\n        UserModel\r\n            .findOne({\r\n                email: email\r\n            }, function (err, existingUser) {\r\n                if (err || !existingUser) {\r\n                    return res.status(401).send(err || {error: \"User Not Found\"})\r\n                }\r\n                if (existingUser) {\r\n                    existingUser.comparedPassword(password, function(err, good) {\r\n                        if (err || !good) {\r\n                                return res.status(401).send(err || 'User not found')\r\n                            }\r\n    \r\n                            res.send({\r\n                                token: token.generateToken(existingUser)\r\n                            })\r\n                    })\r\n                }\r\n            })\r\n    }\r\n}\r\n"]}